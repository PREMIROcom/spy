<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spy Game - Updated</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .setup-screen, .name-screen, .player-screen, .reveal-screen, .voting-screen, .spy-guess-screen, .results-screen {
            display: none;
        }

        .active {
            display: block !important;
        }

        .player-count, .name-input-container {
            margin: 30px 0;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #333;
        }

        input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #1e3c72;
            border-radius: 10px;
            text-align: center;
        }

        .btn {
            width: 100%;
            padding: 18px;
            font-size: 1.3em;
            font-weight: bold;
            background: #1e3c72;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #2a5298;
            transform: translateY(-2px);
        }

        .btn-secondary { background: #48bb78; }
        .btn-danger { background: #f56565; }

        .role-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .role-card.spy {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
        }

        .hidden-card {
            background: #333;
            padding: 60px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            cursor: pointer;
            color: white;
        }

        .timer {
            text-align: center;
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
            margin: 20px 0;
        }

        .location-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
            max-height: 250px;
            overflow-y: auto;
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
        }

        .location-item {
            padding: 8px;
            background: white;
            border-radius: 5px;
            text-align: center;
            font-size: 0.9em;
            border: 1px solid #ddd;
        }

        .vote-buttons, .guess-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: #f7fafc;
            border-radius: 8px;
        }

        .winner {
            background: #48bb78;
            color: white;
            font-weight: bold;
        }

        .summary-box {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üïµÔ∏è Spy Game</h1>
        <p class="subtitle">üé≤ Random Edition</p>

        <div id="setup-screen" class="setup-screen active">
            <div class="player-count">
                <label>How many players?</label>
                <input type="number" id="player-input" min="3" max="50" value="3">
            </div>
            <button class="btn" onclick="startGame()">Start Setup</button>
        </div>

        <div id="name-screen" class="name-screen">
            <h2 style="text-align: center;">Player <span id="name-player-number">1</span></h2>
            <div class="name-input-container">
                <input type="text" id="name-input" placeholder="Enter your name...">
            </div>
            <button class="btn" onclick="saveName()">Continue</button>
        </div>

        <div id="player-screen" class="player-screen">
            <h2 id="current-player-name" style="text-align: center; color: #1e3c72;">Name</h2>
            <div class="hidden-card" id="hidden-card" onclick="revealRole()">
                <h3>Tap to see role</h3>
                <p style="font-size: 0.8em; margin-top: 10px; opacity: 0.7;">Make sure no one is looking!</p>
            </div>
            <div class="role-card" id="role-card" style="display: none;">
                <h2 id="role-title"></h2>
                <div id="role-location" style="font-size: 2.2em; font-weight: bold; margin: 15px 0;"></div>
                <p id="role-subtitle"></p>
            </div>
            <button class="btn" id="next-btn" onclick="nextPlayer()" style="display: none;">Next Player</button>
            <button class="btn btn-secondary" id="start-round-btn" onclick="startRound()" style="display: none;">Start Round!</button>
        </div>

        <div id="reveal-screen" class="reveal-screen">
            <div class="timer" id="timer">1:00</div>
            <p style="text-align: center; color: #666;">Ask questions! Here are the possibilities:</p>
            <div class="location-list" id="all-locations"></div>
            <button class="btn btn-danger" onclick="startVoting()">End Timer & Vote</button>
        </div>

        <div id="voting-screen" class="voting-screen">
            <h2 style="text-align: center;">Voter: <span id="voting-player" style="color: #1e3c72;"></span></h2>
            <p style="text-align: center; margin-bottom: 10px;">Who is the spy?</p>
            <div class="vote-buttons" id="vote-buttons"></div>
        </div>

        <div id="spy-guess-screen" class="spy-guess-screen">
            <h2 style="text-align: center; color: #f56565;">Spy's Turn!</h2>
            <p style="text-align: center; margin-bottom: 15px;"><span id="spy-name-guess" style="font-weight: bold;"></span>, guess the secret item to win 50 points:</p>
            <div class="guess-buttons" id="guess-buttons"></div>
        </div>

        <div id="results-screen" class="results-screen">
            <h2 style="text-align: center; margin-bottom: 20px;">Round Results</h2>
            <div id="round-summary" class="summary-box"></div>
            <div id="score-list"></div>
            <button class="btn btn-secondary" onclick="playAgain()">Next Round</button>
            <button class="btn" onclick="location.reload()">Reset All Scores</button>
        </div>
    </div>

    <script>
        const locations = ['Lip Gloss', 'Phone', 'Laptop', 'Wallet', 'Keys', 'Backpack', 'Water Bottle', 'Sunglasses', 'Watch', 'Umbrella', 'Pen', 'Notebook', 'Headphones', 'Charger', 'Camera', 'Book', 'Flashlight', 'Mirror', 'Comb', 'Toothbrush', 'Soap', 'Towel', 'Pillow', 'Blanket', 'Cup', 'Plate', 'Fork', 'Spoon', 'Knife', 'Bottle', 'Can', 'Box', 'Bag', 'Hat', 'Shoe', 'Sock', 'Shirt', 'Jacket', 'Ring', 'Necklace', 'Bracelet', 'Ball', 'Toy', 'Dice', 'Card', 'Coin', 'Ticket', 'Teacher', 'Doctor', 'Chef', 'Pilot', 'Firefighter', 'Police Officer', 'Nurse', 'Scientist', 'Engineer', 'Farmer', 'Barber', 'Dentist', 'Librarian', 'Janitor', 'Cashier', 'Waiter', 'Baker', 'Photographer', 'Artist', 'Musician', 'Actor', 'Beach', 'Park', 'School', 'Hospital', 'Library', 'Restaurant', 'Cafe', 'Mall', 'Supermarket', 'Bank', 'Gym', 'Movie Theater', 'Museum', 'Zoo', 'Aquarium', 'Airport', 'Hotel', 'Forest', 'Mountain', 'Desert', 'Island', 'Lake', 'Ocean', 'Stadium', 'Playground', 'Bakery', 'Gas Station', 'Farm'];
        
        let numPlayers, spyIndex, secretLocation, timerInterval;
        let playerNames = [];
        let playerScores = {};
        let votes = {};
        let currentPlayerIdx = 0;
        let voterIdx = 0;

        function showScreen(id) {
            document.querySelectorAll('.container > div').forEach(div => div.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startGame() {
            numPlayers = parseInt(document.getElementById('player-input').value);
            if(numPlayers < 3) return alert("Minimum 3 players!");
            playerNames = [];
            showScreen('name-screen');
            document.getElementById('name-input').focus();
        }

        function saveName() {
            const input = document.getElementById('name-input');
            const name = input.value.trim();
            if (!name) return alert("Please enter a name!");
            if (playerNames.includes(name)) return alert("Name already taken!");
            
            playerNames.push(name);
            playerScores[name] = playerScores[name] || 0;
            
            if (playerNames.length < numPlayers) {
                document.getElementById('name-player-number').textContent = playerNames.length + 1;
                input.value = "";
                input.focus();
            } else {
                setupRound();
            }
        }

        function setupRound() {
            spyIndex = Math.floor(Math.random() * numPlayers);
            secretLocation = locations[Math.floor(Math.random() * locations.length)];
            currentPlayerIdx = 0;
            showPlayerTurn();
        }

        function showPlayerTurn() {
            showScreen('player-screen');
            document.getElementById('current-player-name').textContent = playerNames[currentPlayerIdx];
            document.getElementById('hidden-card').style.display = 'block';
            document.getElementById('role-card').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('start-round-btn').style.display = 'none';
        }

        function revealRole() {
            const isSpy = currentPlayerIdx === spyIndex;
            const card = document.getElementById('role-card');
            document.getElementById('hidden-card').style.display = 'none';
            card.style.display = 'flex';
            card.className = isSpy ? 'role-card spy' : 'role-card';
            
            document.getElementById('role-title').textContent = isSpy ? "üïµÔ∏è YOU ARE THE SPY" : "‚úÖ YOU ARE A CITIZEN";
            document.getElementById('role-location').textContent = isSpy ? "???" : secretLocation;
            document.getElementById('role-subtitle').textContent = isSpy ? "Try to figure out the item!" : "Find the spy, don't reveal the item!";

            if (currentPlayerIdx < numPlayers - 1) {
                document.getElementById('next-btn').style.display = 'block';
            } else {
                document.getElementById('start-round-btn').style.display = 'block';
            }
        }

        function nextPlayer() {
            currentPlayerIdx++;
            showPlayerTurn();
        }

        function startRound() {
            showScreen('reveal-screen');
            const list = document.getElementById('all-locations');
            list.innerHTML = locations.map(l => `<div class="location-item">${l}</div>`).join('');
            
            let timeLeft = 60;
            document.getElementById('timer').textContent = "1:00";
            document.getElementById('timer').style.color = "#1e3c72";
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `0:${timeLeft.toString().padStart(2, '0')}`;
                if (timeLeft <= 0) { 
                    clearInterval(timerInterval); 
                    document.getElementById('timer').textContent = "Time's Up!";
                    document.getElementById('timer').style.color = "red";
                }
            }, 1000);
        }

        function startVoting() {
            clearInterval(timerInterval);
            voterIdx = 0;
            votes = {};
            showVotingTurn();
        }

        function showVotingTurn() {
            showScreen('voting-screen');
            document.getElementById('voting-player').textContent = playerNames[voterIdx];
            const btns = document.getElementById('vote-buttons');
            btns.innerHTML = '';
            
            playerNames.forEach((name, idx) => {
                if(idx === voterIdx) return; // Prevent self-voting
                const b = document.createElement('button');
                b.className = 'btn';
                b.textContent = name;
                b.onclick = () => {
                    votes[playerNames[voterIdx]] = idx;
                    voterIdx++;
                    if(voterIdx < numPlayers) showVotingTurn();
                    else showSpyGuess();
                };
                btns.appendChild(b);
            });
        }

        function showSpyGuess() {
            showScreen('spy-guess-screen');
            document.getElementById('spy-name-guess').textContent = playerNames[spyIndex];
            const btns = document.getElementById('guess-buttons');
            btns.innerHTML = '';
            
            let options = [secretLocation];
            while(options.length < 4) {
                let r = locations[Math.floor(Math.random() * locations.length)];
                if(!options.includes(r)) options.push(r);
            }
            options.sort(() => Math.random() - 0.5);

            options.forEach(opt => {
                const b = document.createElement('button');
                b.className = 'btn';
                b.textContent = opt;
                b.onclick = () => processResults(opt === secretLocation);
                btns.appendChild(b);
            });
        }

        function processResults(spyGuessedRight) {
            let spyName = playerNames[spyIndex];
            let summary = `The Spy was <b>${spyName}</b>!<br>`;
            summary += `The secret item was <b>${secretLocation}</b>.<br><br>`;
            
            if(spyGuessedRight) {
                playerScores[spyName] += 50; // Spy gets 50 points
                summary += `üéØ <b>Spy Result:</b> Correct guess! (+50 pts)<br>`;
            } else {
                summary += `‚ùå <b>Spy Result:</b> Wrong guess.<br>`;
            }

            let catchers = [];
            for(let voter in votes) {
                if(votes[voter] === spyIndex) {
                    playerScores[voter] += 50; // Citizens get 50 for catching spy
                    catchers.push(voter);
                }
            }
            
            summary += catchers.length > 0 ? 
                `‚úÖ <b>Citizens:</b> ${catchers.join(', ')} caught the spy! (+50 pts each)` : 
                `‚ùå <b>Citizens:</b> Nobody identified the spy!`;

            document.getElementById('round-summary').innerHTML = summary;
            
            const list = document.getElementById('score-list');
            list.innerHTML = `<h3 style="margin-bottom:10px;">Scoreboard:</h3>` + 
                Object.entries(playerScores)
                .sort((a,b) => b[1] - a[1])
                .map(([name, score], idx) => `<div class="score-item ${idx===0 ? 'winner' : ''}"><span>${name}</span><span>${score} pts</span></div>`)
                .join('');

            showScreen('results-screen');
        }

        function playAgain() {
            setupRound();
        }
    </script>
</body>
</html>